<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#19191B" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Potok ‚Äî Home</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'GA_MEASUREMENT_ID'); // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID
  </script>
  
  <!-- Telegram Web App SDK - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º—É—é —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é -->
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
  
  <!-- TON Connect SDK -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  
  <!-- Telegram Web App Init Script -->
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ SDK
    window.addEventListener('DOMContentLoaded', function() {
      if (window.Telegram && window.Telegram.WebApp) {
        console.log('üöÄ Telegram WebApp SDK loaded successfully');
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();
        
        // –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ UX
        window.Telegram.WebApp.disableVerticalSwipes();
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram
        if (window.Telegram.WebApp.colorScheme === 'dark') {
          document.documentElement.style.setProperty('--main', window.Telegram.WebApp.backgroundColor || '#19191B');
        }
        
        console.log('üì± Platform:', window.Telegram.WebApp.platform);
        console.log('üì± Version:', window.Telegram.WebApp.version);
        console.log('üë§ User data available:', !!window.Telegram.WebApp.initDataUnsafe?.user);
        
        if (window.Telegram.WebApp.initDataUnsafe?.user) {
          console.log('üë§ User:', window.Telegram.WebApp.initDataUnsafe.user);
        }
      } else {
        console.log('‚ö†Ô∏è Telegram WebApp SDK not available - running in browser mode');
      }
    });
  </script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- TON Connect SDK -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  
  <!-- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK Telegram Mini Apps Analytics -->
  <script src="https://cdn.jsdelivr.net/npm/telegram-mini-apps-analytics/dist/index.min.js"></script>
  
  <!-- Telegram Mini Apps Analytics SDK -->
  <script>
    // Telegram Analytics wrapper
    window.TelegramAnalytics = {
      track: function(eventName, parameters) {
        if (window.Telegram?.WebApp?.sendData) {
          try {
            const analyticsData = {
              event: eventName,
              params: parameters,
              timestamp: Date.now(),
              user_id: window.Telegram.WebApp.initDataUnsafe?.user?.id
            };
            console.log('üìä Analytics:', eventName, parameters);
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram Analytics
          } catch (error) {
            console.error('Analytics error:', error);
          }
        }
      }
    };
  </script>
  
  <style>
    :root {
      --main: #19191B;
      --white: #ffffff;
      --text-2: #b3b3b3;
      --green: #34A853;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: var(--main);
      font-family: "Inter", sans-serif;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .home {
      max-width: 375px;
      margin: 0 auto;
      padding: 96px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      padding-bottom: 96px;
      box-sizing: border-box;
    }

    .section-spacing {
      margin-bottom: 0;
    }

    .logo {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 375px;
      width: 100%;
      z-index: 100;
      background-color: var(--main);
      padding: 24px;
      box-sizing: border-box;
    }

    .logo img {
      height: 33px;
      width: auto;
      display: block;
    }

    .user-header {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .avatar-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
      display: block;
      border-radius: 50%;
    }

    .avatar-placeholder {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-2);
    }

    .user-name {
      font-size: 18px;
      line-height: 24px;
      font-weight: 500;
      color: var(--white);
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ton-connect-button {
      background: #0088cc;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      color: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .ton-connect-button:hover {
      background: #0077bb;
    }

    .header {
      max-width: 327px;
      width: 100%;
      margin: 0 auto 48px auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .text-welcome {
      font-size: 14px;
      line-height: 20px;
      font-weight: 400;
      color: var(--text-2);
    }

    .text-title {
      font-size: 24px;
      line-height: 32px;
      font-weight: 600;
      color: var(--white);
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 48px;
    }

    .card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      width: 100%;
      max-width: 327px;
      height: 80px;
      margin: 0 auto;
      box-sizing: border-box;
      padding-right: 16px;
      transition: background-color 0.2s;
    }

    .card:active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .card img:first-child {
      width: 118px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px 0 0 8px;
      flex-shrink: 0;
    }

    .card-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex: 1;
      margin-left: 16px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      line-height: 24px;
      color: var(--white);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-2);
      line-height: 16px;
    }

    .card .arrow {
      width: 5px;
      height: 10px;
      margin-left: 16px;
    }

    /* –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ "–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—Ç—Å—è –≤—ã–±–∏—Ä–∞—Ç—å" */
    .entry-point-title {
      font-size: 14px !important;
      line-height: 20px !important;
      font-weight: 500 !important;
      color: #B3B3B3 !important;
      margin-bottom: 24px !important;
      text-align: left;
    }

    .preview-container {
      width: 100%;
      max-width: 327px;
      height: 120px;
      background-color: var(--green);
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      margin: 0 auto;
    }

    .preview-container:active {
      transform: scale(0.98);
    }

    .preview-animation {
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .arrow {
      width: 5px;
      height: 10px;
    }

    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 375px;
      background-color: var(--main);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
    }

    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      line-height: 18px;
      font-weight: 400;
      color: var(--text-2);
      gap: 8px;
    }

    .tab.active {
      font-weight: 600;
      color: var(--green);
    }

    .tab.active img {
      filter: brightness(1.5);
    }

    .tab img {
      width: 24px;
      height: 24px;
      transition: transform 0.1s, filter 0.1s;
    }

    .tab img:active {
      transform: scale(0.9);
      filter: brightness(1.5);
    }

    /* TON Connect specific styles - —Å–∫—Ä—ã—Ç—ã, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç */
    .ton-connect-wrapper {
      margin-left: auto;
      display: none !important; /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ */
    }

    .wallet-status {
      position: fixed;
      top: 80px;
      right: 24px;
      background: rgba(0, 136, 204, 0.1);
      border: 1px solid rgba(0, 136, 204, 0.3);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 10px;
      color: #0088cc;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      display: none; /* –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞ */
    }

    .wallet-status.show {
      opacity: 1;
    }

    .support-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px !important;
      margin-top: 48px !important;
      padding: 0 !important;
    }

    .support-item {
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      gap: 12px !important;
      padding: 0 !important;
      font-size: 12px !important;
      line-height: 18px !important;
      font-weight: 400 !important;
      color: var(--text-2) !important;
      transition: opacity 0.2s !important;
      cursor: pointer !important;
      margin: 0 !important;
      width: 100% !important;
      box-sizing: border-box !important;
    }

    .support-item:hover {
      opacity: 0.8;
    }

    .support-item:active {
      opacity: 0.6;
    }

    .support-item svg {
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="home">
    <!-- –ê–≤–∞—Ç–∞—Ä –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
    <div class="logo" id="headerLogo">
      <div class="user-header">
        <div class="user-avatar">
          <div class="avatar-placeholder">–ê</div>
        </div>
        <div class="user-name">–ê–Ω–Ω–∞</div>
      </div>
    </div>

    <div class="header">
      <div class="text-welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
      <div class="text-title">–° —á–µ–≥–æ —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å?</div>
    </div>

    <div class="cards">
      <a href="pause.html" class="card">
        <img src="img/mind.jpg" alt="–£—Å–ø–æ–∫–æ–∏—Ç—å –º—ã—Å–ª–∏">
        <div class="card-content">
          <div class="card-title">–£—Å–ø–æ–∫–æ–∏—Ç—å –º—ã—Å–ª–∏</div>
          <div class="card-subtitle">–ú–µ–¥–∏—Ç–∞—Ü–∏—è ‚Ä¢ 5 –º–∏–Ω</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="478.html" class="card">
        <img src="img/breathing.jpg" alt="–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å">
        <div class="card-content">
          <div class="card-title">–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å</div>
          <div class="card-subtitle">–î—ã—Ö–∞–Ω–∏–µ ‚Ä¢ 1-2 –º–∏–Ω</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="stars.html" class="card">
        <img src="img/sleep.jpg" alt="–£–ª—É—á—à–∏—Ç—å —Å–æ–Ω">
        <div class="card-content">
          <div class="card-title">–£–ª—É—á—à–∏—Ç—å —Å–æ–Ω</div>
          <div class="card-subtitle">–°–æ–Ω ‚Ä¢ 5 –º–∏–Ω</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
    </div>

    <div class="entry-point-title">–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—Ç—Å—è –≤—ã–±–∏—Ä–∞—Ç—å</div>

    <div class="preview-container section-spacing" id="practiceOfDay">
      <svg class="preview-animation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 327 120">
        <!-- Background -->
        <rect width="327" height="120" fill="#34A853" rx="8" />
        
        <!-- Random white dots -->
        <circle cx="60" cy="25" r="1.5" fill="white" opacity="0.7">
          <animate attributeName="opacity" values="0.7;0.3;0.7" dur="2.5s" repeatCount="indefinite"/>
        </circle>
        <circle cx="270" cy="30" r="2" fill="white" opacity="0.5">
          <animate attributeName="opacity" values="0.5;0.8;0.5" dur="3s" repeatCount="indefinite"/>
        </circle>
        <circle cx="250" cy="90" r="1" fill="white" opacity="0.6">
          <animate attributeName="opacity" values="0.6;0.2;0.6" dur="2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="80" cy="85" r="1.8" fill="white" opacity="0.4">
          <animate attributeName="opacity" values="0.4;0.7;0.4" dur="3.5s" repeatCount="indefinite"/>
        </circle>
        <circle cx="180" cy="20" r="1.2" fill="white" opacity="0.8">
          <animate attributeName="opacity" values="0.8;0.4;0.8" dur="2.2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="300" cy="70" r="1.4" fill="white" opacity="0.6">
          <animate attributeName="opacity" values="0.6;0.9;0.6" dur="2.8s" repeatCount="indefinite"/>
        </circle>
        <circle cx="40" cy="60" r="2.2" fill="white" opacity="0.3">
          <animate attributeName="opacity" values="0.3;0.6;0.3" dur="3.2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="200" cy="100" r="1.6" fill="white" opacity="0.7">
          <animate attributeName="opacity" values="0.7;0.2;0.7" dur="2.4s" repeatCount="indefinite"/>
        </circle>
        
        <!-- 5 –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤–æ–ª–Ω -->
        <!-- Wave 1 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="0s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="0s"
          />
        </circle>
        
        <!-- Wave 2 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="1.6s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="1.6s"
          />
        </circle>
        
        <!-- Wave 3 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="3.2s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="3.2s"
          />
        </circle>
        
        <!-- Wave 4 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="4.8s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="4.8s"
          />
        </circle>
        
        <!-- Wave 5 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="6.4s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="6.4s"
          />
        </circle>
        
        <!-- Play button overlay -->
        <g transform="translate(163.5, 60)">
          <!-- Button background -->
          <circle r="24" fill="rgba(255, 255, 255, 0.03)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="1"/>
          <!-- Play icon -->
          <path d="M-6 -8 L-6 8 L8 0 Z" fill="white" opacity="0.9"/>
        </g>
      </svg>
    </div>

    <!-- Support and Terms block -->
    <div class="support-block">
      <a href="https://t.me/spoksupport_bot" class="support-item">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.3666 3.84166C16.941 3.41583 16.4356 3.07803 15.8794 2.84757C15.3232 2.61711 14.7271 2.49847 14.1249 2.49847C13.5227 2.49847 12.9266 2.61711 12.3704 2.84757C11.8142 3.07803 11.3088 3.41583 10.8832 3.84166L9.99989 4.725L9.11656 3.84166C8.25686 2.98196 7.09089 2.49879 5.87489 2.49879C4.65889 2.49879 3.49292 2.98196 2.63322 3.84166C1.77352 4.70136 1.29036 5.86733 1.29036 7.08333C1.29036 8.29933 1.77352 9.4653 2.63322 10.325L3.51656 11.2083L9.99989 17.6917L16.4832 11.2083L17.3666 10.325C17.7924 9.89937 18.1302 9.39399 18.3607 8.83779C18.5911 8.28158 18.7098 7.68546 18.7098 7.08333C18.7098 6.48121 18.5911 5.88508 18.3607 5.32888C18.1302 4.77267 17.7924 4.26729 17.3666 3.84166Z" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏!</span>
      </a>
      
      <a href="privacy.html" class="support-item">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 4H16V16H4V4Z" stroke="#B3B3B3" stroke-width="1.5"/>
          <path d="M6 8H14" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M6 11H14" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M6 14H10" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span>–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</span>
      </a>
    </div>
  </div>

  <!-- TON Wallet Status -->
  <div class="wallet-status" id="walletStatus">
    –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
  </div>

  <footer class="tab-bar">
    <a href="index.html" class="tab active">
      <img src="img/home-active.svg" alt="–°–µ–≥–æ–¥–Ω—è">
      <div>–°–µ–≥–æ–¥–Ω—è</div>
    </a>
    <a href="practices.html" class="tab">
      <img src="img/practices.svg" alt="–ü—Ä–∞–∫—Ç–∏–∫–∏">
      <div>–ü—Ä–∞–∫—Ç–∏–∫–∏</div>
    </a>
    <a href="journal.html" class="tab">
      <img src="img/journal.svg" alt="–ñ—É—Ä–Ω–∞–ª">
      <div>–ñ—É—Ä–Ω–∞–ª</div>
    </a>
  </footer>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
    class PotokTelegramApp {
      constructor() {
        this.tg = window.Telegram?.WebApp;
        this.tonConnectUI = null;
        this.user = null;
        this.isReady = false;
        
        // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ Telegram SDK
        if (this.tg) {
          this.initTelegramApp();
        } else {
          // Fallback –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ Telegram
          this.initBrowserMode();
        }
      }

      initTelegramApp() {
        console.log('üöÄ Initializing Telegram Mini App...');
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram WebApp
        this.tg.ready();
        this.tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ UI
        this.tg.enableClosingConfirmation();
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ Telegram
        this.tg.MainButton.hide();
        this.tg.BackButton.hide();
        if (this.tg.SettingsButton) {
          this.tg.SettingsButton.hide();
        }
        
        // –ü–†–û–°–¢–û–ï –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        this.user = this.tg.initDataUnsafe?.user || null;
        
        console.log('üë§ User data from Telegram:', this.user);
        console.log('üîç Full initDataUnsafe:', this.tg.initDataUnsafe);
        
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –µ—â–µ —Ä–∞–∑
        if (!this.user) {
          console.log('‚è≥ No user data immediately, trying again in 2 seconds...');
          setTimeout(() => {
            this.user = this.tg.initDataUnsafe?.user || null;
            console.log('üë§ Delayed user data check:', this.user);
            if (this.user) {
              this.updateUserInterface();
            }
          }, 2000);
        }
        
        // –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É Telegram - —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å-–±–∞—Ä
        const metaTheme = document.querySelector('meta[name="theme-color"]');
        if (metaTheme) {
          metaTheme.setAttribute('content', '#19191B');
        }
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º viewport
        this.setupViewport();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
        this.initializeComponents();
        
        console.log('‚úÖ Telegram Mini App initialized');
      }

      initBrowserMode() {
        console.log('üåê Running in browser mode (outside Telegram)');
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        this.user = {
          id: 12345,
          first_name: "–¢–µ—Å—Ç–æ–≤—ã–π",
          last_name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", 
          username: "test_user",
          language_code: "ru",
          photo_url: null
        };
        
        this.initializeComponents();
      }

      extractUserData() {
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
        console.log('üîç Extracting user data from Telegram...');
        console.log('üîç initDataUnsafe:', this.tg.initDataUnsafe);
        console.log('üîç initData raw:', this.tg.initData);
        
        const initData = this.tg.initDataUnsafe;
        
        if (initData && initData.user) {
          this.user = initData.user;
          console.log('‚úÖ User data extracted successfully:', this.user);
          
          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          console.log('üë§ User ID:', this.user.id);
          console.log('üë§ First name:', this.user.first_name);
          console.log('üë§ Last name:', this.user.last_name);
          console.log('üë§ Username:', this.user.username);
          console.log('üë§ Language:', this.user.language_code);
          console.log('üì∏ Photo URL:', this.user.photo_url);
          
          if (initData.start_param) {
            console.log('üîó Start parameter:', initData.start_param);
          }
          
          if (initData.chat) {
            console.log('üí¨ Chat info:', initData.chat);
          }
          
          // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
          this.updateUserInterface();
          
        } else {
          console.log('‚ùå No user data in initDataUnsafe, trying alternatives...');
          this.tryAlternativeUserExtraction();
        }
      }

      tryAlternativeUserExtraction() {
        console.log('üîÑ Trying alternative user data extraction methods...');
        
        let attempts = 0;
        const maxAttempts = 5;
        
        const tryExtract = () => {
          attempts++;
          console.log(`üîÑ Attempt ${attempts}/${maxAttempts} to get user data...`);
          
          // –°–ø–æ—Å–æ–± 1: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ initDataUnsafe (–º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
          if (this.tg.initDataUnsafe?.user) {
            this.user = this.tg.initDataUnsafe.user;
            console.log('‚úÖ User data found in delayed check:', this.user);
            this.updateUserInterface();
            return;
          }
          
          // –°–ø–æ—Å–æ–± 2: –ü—Ä—è–º–æ–π –ø–∞—Ä—Å–∏–Ω–≥ initData
          if (this.tg.initData) {
            try {
              console.log('üîç Trying to parse initData manually...');
              const params = new URLSearchParams(this.tg.initData);
              const userParam = params.get('user');
              console.log('üîç User param from initData:', userParam);
              
              if (userParam) {
                this.user = JSON.parse(decodeURIComponent(userParam));
                console.log('‚úÖ User data parsed from initData:', this.user);
                this.updateUserInterface();
                return;
              }
            } catch (error) {
              console.log('‚ùå Failed to parse initData:', error);
            }
          }
          
          // –°–ø–æ—Å–æ–± 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
          if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
            this.user = window.Telegram.WebApp.initDataUnsafe.user;
            console.log('‚úÖ User data from global Telegram object:', this.user);
            this.updateUserInterface();
            return;
          }
          
          // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –∏ –µ—â–µ –µ—Å—Ç—å –ø–æ–ø—ã—Ç–∫–∏ - –ø–æ–≤—Ç–æ—Ä—è–µ–º —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
          if (attempts < maxAttempts) {
            setTimeout(tryExtract, 1000);
          } else {
            console.log('‚ùå All attempts failed, user data not available');
            console.log('‚ÑπÔ∏è This might happen if:');
            console.log('  - App is not opened from Telegram');
            console.log('  - User data access is restricted');
            console.log('  - Telegram version is too old');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º placeholder –¥–∞–Ω–Ω—ã–µ, –Ω–æ –ø–æ–º–µ—á–∞–µ–º —á—Ç–æ —ç—Ç–æ fallback
            this.user = null;
            this.updateUserInterface();
          }
        };
        
        // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
        tryExtract();
      }

      applyTelegramTheme() {
        // –ü–û–õ–ù–û–°–¢–¨–Æ –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã Telegram
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–≤–µ—Ç —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞
        const metaTheme = document.querySelector('meta[name="theme-color"]');
        if (metaTheme) {
          metaTheme.setAttribute('content', '#19191B');
        }
        
        console.log('üé® Telegram theme application disabled - keeping original Potok colors');
        
        // –ù–ï –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
        // –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∏–∫–∞–∫–∏–µ —Ü–≤–µ—Ç–∞ –∏–∑ themeParams
      }

      setupViewport() {
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ viewport –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π viewport
        this.tg.onEvent('viewportChanged', () => {
          console.log('üì± Viewport changed:', this.tg.viewportHeight, this.tg.viewportStableHeight);
          this.adjustLayoutForViewport();
        });
      }

      adjustLayoutForViewport() {
        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è viewport
        const viewportHeight = this.tg.viewportHeight || window.innerHeight;
        document.documentElement.style.setProperty('--viewport-height', `${viewportHeight}px`);
      }

      async initializeComponents() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect
        await this.initTONConnect();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π
        this.setupEventListeners();
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        this.updateUserInterface();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
        this.initAnalytics();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö—ç–ø—Ç–∏–∫–∏
        this.setupHapticFeedback();
        
        this.isReady = true;
        console.log('‚úÖ All components initialized');
      }

      updateUserInterface() {
        this.updateUserHeader();
        this.updateWelcomeMessage();
      }

      updateUserHeader() {
        const headerLogo = document.getElementById('headerLogo');
        if (!headerLogo) {
          console.log('‚ùå Header element not found');
          return;
        }
        
        if (this.user) {
          console.log('üîÑ Updating header with Telegram user data:', this.user);
          
          const firstName = this.user.first_name || this.user.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
          const photoUrl = this.getUserPhotoUrl();
          
          console.log('üë§ Display name:', firstName);
          console.log('üì∏ Photo URL:', photoUrl);
          
          headerLogo.innerHTML = `
            <div class="user-header">
              <div class="user-avatar">
                ${photoUrl ? 
                  `<img src="${photoUrl}" alt="${firstName}" class="avatar-image" 
                        onerror="console.log('Photo load failed, showing placeholder'); this.style.display='none'; this.parentNode.querySelector('.avatar-placeholder').style.display='flex';"
                        onload="console.log('Photo loaded successfully');">` : ''
                }
                <div class="avatar-placeholder" style="${photoUrl ? 'display: none;' : ''}">${firstName.charAt(0).toUpperCase()}</div>
              </div>
              <div class="user-name">${firstName}</div>
            </div>
          `;
          
          console.log('‚úÖ Header updated with user data');
          
        } else {
          console.log('üîÑ No user data available, showing logo');
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–æ—Ç–∏–ø, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          headerLogo.innerHTML = `<img src="img/logo.svg" alt="Potok logo">`;
        }
      }

      getUserPhotoUrl() {
        if (!this.user?.photo_url) {
          console.log('üì∏ No photo_url in user data');
          return null;
        }
        
        console.log('üì∏ Raw photo_url:', this.user.photo_url);
        
        // Telegram –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å photo_url –∫–∞–∫ –æ–±—ä–µ–∫—Ç –∏–ª–∏ —Å—Ç—Ä–æ–∫—É
        if (typeof this.user.photo_url === 'string') {
          console.log('üì∏ Photo URL is string:', this.user.photo_url);
          return this.user.photo_url;
        }
        
        if (typeof this.user.photo_url === 'object') {
          console.log('üì∏ Photo URL is object:', this.user.photo_url);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
          if (this.user.photo_url.url) {
            return this.user.photo_url.url;
          }
          
          if (this.user.photo_url.small_file_url) {
            return this.user.photo_url.small_file_url;
          }
          
          if (this.user.photo_url.big_file_url) {
            return this.user.photo_url.big_file_url;
          }
        }
        
        console.log('üì∏ Could not extract photo URL from:', this.user.photo_url);
        return null;
      }

      updateWelcomeMessage() {
        const welcomeElement = document.querySelector('.text-welcome');
        if (welcomeElement && this.user?.first_name) {
          const timeOfDay = this.getTimeOfDay();
          welcomeElement.textContent = `${timeOfDay}, ${this.user.first_name}!`;
        }
      }

      getTimeOfDay() {
        const hour = new Date().getHours();
        if (hour < 12) return '–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ';
        if (hour < 17) return '–î–æ–±—Ä—ã–π –¥–µ–Ω—å';
        if (hour < 22) return '–î–æ–±—Ä—ã–π –≤–µ—á–µ—Ä';
        return '–î–æ–±—Ä–æ–π –Ω–æ—á–∏';
      }

      async initTONConnect() {
        try {
          if (typeof TON_CONNECT_UI !== 'undefined') {
            this.tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
              manifestUrl: window.location.origin + '/tonconnect-manifest.json'
            });

            this.tonConnectUI.onStatusChange((walletInfo) => {
              this.handleWalletConnection(walletInfo);
            });

            console.log('‚úÖ TON Connect SDK initialized');
          }
        } catch (error) {
          console.error('‚ùå TON Connect initialization failed:', error);
        }
      }

      handleWalletConnection(walletInfo) {
        if (walletInfo) {
          console.log('üí∞ Wallet connected:', walletInfo);
          this.trackEvent('wallet_connected', {
            wallet: walletInfo.device?.appName || 'unknown',
            user_id: this.user?.id
          });
          this.triggerHapticFeedback('success');
        } else {
          console.log('üí∞ Wallet disconnected');
          this.trackEvent('wallet_disconnected', {
            user_id: this.user?.id
          });
        }
      }

      initAnalytics() {
        // Google Analytics
        this.trackEvent('app_initialized', {
          user_id: this.user?.id,
          timestamp: Date.now(),
          platform: 'telegram_mini_app',
          version: this.tg?.version || 'unknown'
        });

        console.log('‚úÖ Analytics initialized');
      }

      trackEvent(eventName, parameters = {}) {
        // Google Analytics
        if (typeof gtag !== 'undefined') {
          gtag('event', eventName, {
            event_category: 'telegram_mini_app',
            event_label: parameters.practice_type || parameters.tab || 'general',
            user_id: parameters.user_id,
            custom_parameters: parameters
          });
        }

        // Telegram Analytics
        if (window.TelegramAnalytics) {
          window.TelegramAnalytics.track(eventName, parameters);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram WebApp (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
        if (this.tg?.sendData) {
          try {
            this.tg.sendData(JSON.stringify({
              event: eventName,
              ...parameters
            }));
          } catch (error) {
            console.log('Analytics send error:', error);
          }
        }

        console.log(`üìä Event tracked: ${eventName}`, parameters);
      }

      // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram
      showAlert(message) {
        if (this.tg?.showAlert) {
          this.tg.showAlert(message);
        } else {
          alert(message);
        }
      }

      showConfirm(message, callback) {
        if (this.tg?.showConfirm) {
          this.tg.showConfirm(message, callback);
        } else {
          const result = confirm(message);
          callback(result);
        }
      }

      copyToClipboard(text) {
        if (navigator.clipboard) {
          navigator.clipboard.writeText(text);
          this.showAlert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
        }
      }

      shareContent(url, text) {
        if (navigator.share) {
          navigator.share({
            title: 'Potok - –ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å',
            text: text,
            url: url
          });
        } else if (this.tg?.openTelegramLink) {
          const shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
          this.tg.openTelegramLink(shareUrl);
        }
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üì± DOM loaded, initializing Potok Telegram App...');
      window.potokApp = new PotokTelegramApp();
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    window.addEventListener('error', (error) => {
      console.error('üö® Global error:', error);
      if (window.potokApp?.trackEvent) {
        window.potokApp.trackEvent('app_error', {
          error: error.message,
          stack: error.stack,
          user_id: window.potokApp.user?.id
        });
      }
    });

        // Add click handler (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ)
        const tonBtn = document.getElementById('tonConnectBtn');
        if (tonBtn) {
          tonBtn.addEventListener('click', () => {
            this.showWalletStatus('TON Connect –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è...');
            // In real app, this would open TON Connect modal
          });
        }
      }

      updateUserHeader() {
        if (!this.user) {
          console.log('‚ùå No user data for header update');
          return;
        }
        
        console.log('üîÑ Updating user header with:', this.user);
        
        const headerLogo = document.getElementById('headerLogo');
        headerLogo.innerHTML = `
          <div class="user-header">
            <div class="user-avatar">
              ${this.user.photo_url ? 
                `<img src="${this.user.photo_url}" alt="${this.user.first_name}" class="avatar-image">` :
                `<div class="avatar-placeholder">${this.user.first_name?.charAt(0).toUpperCase() || '–ü'}</div>`
              }
            </div>
            <div class="user-name">${this.user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
          </div>
          <!-- TON Connect –∫–Ω–æ–ø–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–∞, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ -->
          <button class="ton-connect-button" id="tonConnectBtn" style="display: none; position: absolute; visibility: hidden;">TON</button>