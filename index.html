<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#19191B" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Potok ‚Äî Home</title>
  
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- TON Connect SDK -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  
  <!-- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK Telegram Mini Apps Analytics -->
  <script src="https://cdn.jsdelivr.net/npm/telegram-mini-apps-analytics/dist/index.min.js"></script>
  
  <!-- Telegram Mini Apps Analytics SDK -->
  <script>
    // Telegram Analytics wrapper
    window.TelegramAnalytics = {
      track: function(eventName, parameters) {
        if (window.Telegram?.WebApp?.sendData) {
          try {
            const analyticsData = {
              event: eventName,
              params: parameters,
              timestamp: Date.now(),
              user_id: window.Telegram.WebApp.initDataUnsafe?.user?.id
            };
            console.log('üìä Analytics:', eventName, parameters);
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram Analytics
          } catch (error) {
            console.error('Analytics error:', error);
          }
        }
      }
    };
  </script>
  
  <style>
    :root {
      --main: #19191B;
      --white: #ffffff;
      --text-2: #b3b3b3;
      --green: #34A853;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: var(--main);
      font-family: "Inter", sans-serif;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .home {
      max-width: 375px;
      margin: 0 auto;
      padding: 96px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      padding-bottom: 96px;
      box-sizing: border-box;
    }

    .section-spacing {
      margin-bottom: 48px;
    }

    .logo {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 375px;
      width: 100%;
      z-index: 100;
      background-color: var(--main);
      padding: 24px;
      box-sizing: border-box;
    }

    .logo img {
      height: 33px;
      width: auto;
      display: block;
    }

    .user-header {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .avatar-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
      display: block;
      border-radius: 50%;
    }

    .avatar-placeholder {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-2);
    }

    .user-name {
      font-size: 18px;
      line-height: 24px;
      font-weight: 500;
      color: var(--white);
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .ton-connect-button {
      background: #0088cc;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      color: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .ton-connect-button:hover {
      background: #0077bb;
    }

    .header {
      max-width: 327px;
      width: 100%;
      margin: 0 auto 48px auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .text-welcome {
      font-size: 14px;
      line-height: 20px;
      font-weight: 400;
      color: var(--text-2);
    }

    .text-title {
      font-size: 24px;
      line-height: 32px;
      font-weight: 600;
      color: var(--white);
    }

    .preview-container {
      width: 100%;
      max-width: 327px;
      height: 120px;
      background-color: var(--green);
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
      margin: 0 auto;
    }

    .preview-container:active {
      transform: scale(0.98);
    }

    .preview-animation {
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .arrow {
      width: 5px;
      height: 10px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-top: 48px;
    }

    .card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      width: 100%;
      max-width: 327px;
      height: 80px;
      margin: 0 auto;
      box-sizing: border-box;
      padding-right: 16px;
      transition: background-color 0.2s;
    }

    .card:active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .card img:first-child {
      width: 118px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px 0 0 8px;
      flex-shrink: 0;
    }

    .card-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex: 1;
      margin-left: 16px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      line-height: 24px;
      color: var(--white);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-2);
      line-height: 16px;
    }

    .card .arrow {
      width: 5px;
      height: 10px;
      margin-left: 16px;
    }

    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 375px;
      background-color: var(--main);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
    }

    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      line-height: 18px;
      font-weight: 400;
      color: var(--text-2);
      gap: 8px;
    }

    .tab.active {
      font-weight: 600;
      color: var(--green);
    }

    .tab.active img {
      filter: brightness(1.5);
    }

    .tab img {
      width: 24px;
      height: 24px;
      transition: transform 0.1s, filter 0.1s;
    }

    .tab img:active {
      transform: scale(0.9);
      filter: brightness(1.5);
    }

    /* TON Connect specific styles - —Å–∫—Ä—ã—Ç—ã, –Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç */
    .ton-connect-wrapper {
      margin-left: auto;
      display: none !important; /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ */
    }

    .wallet-status {
      position: fixed;
      top: 80px;
      right: 24px;
      background: rgba(0, 136, 204, 0.1);
      border: 1px solid rgba(0, 136, 204, 0.3);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 10px;
      color: #0088cc;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      display: none; /* –¢–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞ */
    }

    .wallet-status.show {
      opacity: 1;
    }

    .support-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      margin-top: 72px;
      padding: 0 12px;
    }

    .support-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 4px 16px;
      font-size: 12px;
      line-height: 18px;
      font-weight: 400;
      color: var(--text-2);
      transition: opacity 0.2s;
      cursor: pointer;
    }

    .support-item:hover {
      opacity: 0.8;
    }

    .support-item:active {
      opacity: 0.6;
    }

    .support-item svg {
      flex-shrink: 0;
    }
  </style>
</head>
<body>
  <div class="home">
    <!-- –ê–≤–∞—Ç–∞—Ä –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram -->
    <div class="logo" id="headerLogo">
      <div class="user-header">
        <div class="user-avatar">
          <div class="avatar-placeholder">–ü</div>
        </div>
        <div class="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
      </div>
    </div>

    <div class="header">
      <div class="text-welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
      <div class="text-title">–° —á–µ–≥–æ —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å?</div>
    </div>

    <div class="preview-container section-spacing" id="practiceOfDay">
      <svg class="preview-animation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 327 120">
        <!-- Background -->
        <rect width="327" height="120" fill="#34A853" rx="8" />
        
        <!-- Random white dots -->
        <circle cx="60" cy="25" r="1.5" fill="white" opacity="0.7">
          <animate attributeName="opacity" values="0.7;0.3;0.7" dur="2.5s" repeatCount="indefinite"/>
        </circle>
        <circle cx="270" cy="30" r="2" fill="white" opacity="0.5">
          <animate attributeName="opacity" values="0.5;0.8;0.5" dur="3s" repeatCount="indefinite"/>
        </circle>
        <circle cx="250" cy="90" r="1" fill="white" opacity="0.6">
          <animate attributeName="opacity" values="0.6;0.2;0.6" dur="2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="80" cy="85" r="1.8" fill="white" opacity="0.4">
          <animate attributeName="opacity" values="0.4;0.7;0.4" dur="3.5s" repeatCount="indefinite"/>
        </circle>
        <circle cx="180" cy="20" r="1.2" fill="white" opacity="0.8">
          <animate attributeName="opacity" values="0.8;0.4;0.8" dur="2.2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="300" cy="70" r="1.4" fill="white" opacity="0.6">
          <animate attributeName="opacity" values="0.6;0.9;0.6" dur="2.8s" repeatCount="indefinite"/>
        </circle>
        <circle cx="40" cy="60" r="2.2" fill="white" opacity="0.3">
          <animate attributeName="opacity" values="0.3;0.6;0.3" dur="3.2s" repeatCount="indefinite"/>
        </circle>
        <circle cx="200" cy="100" r="1.6" fill="white" opacity="0.7">
          <animate attributeName="opacity" values="0.7;0.2;0.7" dur="2.4s" repeatCount="indefinite"/>
        </circle>
        
        <!-- 5 –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –≤–æ–ª–Ω -->
        <!-- Wave 1 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="0s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="0s"
          />
        </circle>
        
        <!-- Wave 2 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="1.6s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="1.6s"
          />
        </circle>
        
        <!-- Wave 3 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="3.2s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="3.2s"
          />
        </circle>
        
        <!-- Wave 4 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="4.8s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="4.8s"
          />
        </circle>
        
        <!-- Wave 5 -->
        <circle cx="163.5" cy="60" r="45" fill="rgba(220, 255, 220, 0.5)" opacity="0">
          <animate 
            attributeName="r" 
            values="45;10" 
            dur="8s" 
            repeatCount="indefinite"
            begin="6.4s"
          />
          <animate 
            attributeName="opacity" 
            values="0;0.5;0.9" 
            dur="8s" 
            repeatCount="indefinite"
            begin="6.4s"
          />
        </circle>
        
        <!-- Play button overlay -->
        <g transform="translate(163.5, 60)">
          <!-- Button background -->
          <circle r="24" fill="rgba(255, 255, 255, 0.03)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="1"/>
          <!-- Play icon -->
          <path d="M-6 -8 L-6 8 L8 0 Z" fill="white" opacity="0.9"/>
        </g>
      </svg>
    </div>

    <div class="cards">
      <a href="pause.html" class="card">
        <img src="img/mind.jpg" alt="–£—Å–ø–æ–∫–æ–∏—Ç—å –º—ã—Å–ª–∏">
        <div class="card-content">
          <div class="card-title">–£—Å–ø–æ–∫–æ–∏—Ç—å –º—ã—Å–ª–∏</div>
          <div class="card-subtitle">–ú–µ–¥–∏—Ç–∞—Ü–∏—è</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="478.html" class="card">
        <img src="img/breathing.jpg" alt="–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å">
        <div class="card-content">
          <div class="card-title">–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å</div>
          <div class="card-subtitle">–î—ã—Ö–∞–Ω–∏–µ</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="stars.html" class="card">
        <img src="img/sleep.jpg" alt="–£–ª—É—á—à–∏—Ç—å —Å–æ–Ω">
        <div class="card-content">
          <div class="card-title">–£–ª—É—á—à–∏—Ç—å —Å–æ–Ω</div>
          <div class="card-subtitle">–°–æ–Ω</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
    </div>

    <!-- Support and Terms block -->
    <div class="support-block">
      <a href="https://t.me/spoksupport_bot" class="support-item">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.3666 3.84166C16.941 3.41583 16.4356 3.07803 15.8794 2.84757C15.3232 2.61711 14.7271 2.49847 14.1249 2.49847C13.5227 2.49847 12.9266 2.61711 12.3704 2.84757C11.8142 3.07803 11.3088 3.41583 10.8832 3.84166L9.99989 4.725L9.11656 3.84166C8.25686 2.98196 7.09089 2.49879 5.87489 2.49879C4.65889 2.49879 3.49292 2.98196 2.63322 3.84166C1.77352 4.70136 1.29036 5.86733 1.29036 7.08333C1.29036 8.29933 1.77352 9.4653 2.63322 10.325L3.51656 11.2083L9.99989 17.6917L16.4832 11.2083L17.3666 10.325C17.7924 9.89937 18.1302 9.39399 18.3607 8.83779C18.5911 8.28158 18.7098 7.68546 18.7098 7.08333C18.7098 6.48121 18.5911 5.88508 18.3607 5.32888C18.1302 4.77267 17.7924 4.26729 17.3666 3.84166Z" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏!</span>
      </a>
      
      <a href="privacy.html" class="support-item">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 4H16V16H4V4Z" stroke="#B3B3B3" stroke-width="1.5"/>
          <path d="M6 8H14" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M6 11H14" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
          <path d="M6 14H10" stroke="#B3B3B3" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span>–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</span>
      </a>
    </div>
  </div>

  <!-- TON Wallet Status -->
  <div class="wallet-status" id="walletStatus">
    –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
  </div>

  <footer class="tab-bar">
    <a href="index.html" class="tab active">
      <img src="img/home-active.svg" alt="–°–µ–≥–æ–¥–Ω—è">
      <div>–°–µ–≥–æ–¥–Ω—è</div>
    </a>
    <a href="practices.html" class="tab">
      <img src="img/practices.svg" alt="–ü—Ä–∞–∫—Ç–∏–∫–∏">
      <div>–ü—Ä–∞–∫—Ç–∏–∫–∏</div>
    </a>
    <a href="journal.html" class="tab">
      <img src="img/journal.svg" alt="–ñ—É—Ä–Ω–∞–ª">
      <div>–ñ—É—Ä–Ω–∞–ª</div>
    </a>
  </footer>

  <script>
    // Initialize Telegram Mini App with all required SDKs
    class PotokTelegramApp {
      constructor() {
        this.tg = window.Telegram?.WebApp;
        this.tonConnectUI = null;
        this.user = null;
        
        this.init();
      }

      async init() {
        console.log('üöÄ Initializing Potok Telegram Mini App...');
        
        // Initialize Telegram Web App SDK
        this.initTelegramWebApp();
        
        // Initialize TON Connect SDK
        await this.initTONConnect();
        
        // Initialize Analytics tracking
        this.initAnalytics();
        
        // Setup Event Listeners
        this.setupEventListeners();
        
        console.log('‚úÖ All SDKs initialized successfully!');
      }

      initTelegramWebApp() {
        if (!this.tg) {
          console.log('‚ö†Ô∏è Running outside Telegram, using test data');
          this.user = {
            id: 12345,
            first_name: "–ê–Ω–Ω–∞", 
            last_name: "–ò–≤–∞–Ω–æ–≤–∞",
            username: "anna_test",
            photo_url: null
          };
          console.log('üë§ Test user data set:', this.user);
          this.updateUserHeader();
          return;
        }

        console.log('‚úÖ Telegram Web App SDK detected');
        
        // Configure Telegram Web App
        this.tg.ready();
        
        // Initialize Telegram Analytics with error handling
        try {
          if (typeof TelegramMiniAppsAnalytics !== 'undefined') {
            TelegramMiniAppsAnalytics.init('your_app_id'); // –∑–∞–º–µ–Ω–∏—à—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π ID
            console.log('‚úÖ Official Telegram Analytics initialized');
          } else {
            console.log('‚ö†Ô∏è Official Telegram Analytics not loaded');
          }
        } catch (error) {
          console.error('‚ùå Telegram Analytics initialization failed:', error);
        }
        
        this.tg.expand();
        this.tg.enableClosingConfirmation();
        
        // Hide default Telegram buttons
        this.tg.MainButton.hide();
        this.tg.BackButton.hide();
        
        // Get user data from Telegram
        this.user = this.tg.initDataUnsafe?.user;
        if (this.user) {
          console.log('üë§ User data received:', this.user);
          this.updateUserHeader();
        }

        // Apply Telegram theme colors
        if (this.tg.themeParams) {
          document.documentElement.style.setProperty('--tg-bg', this.tg.themeParams.bg_color || '#19191B');
          document.documentElement.style.setProperty('--tg-text', this.tg.themeParams.text_color || '#ffffff');
        }
      }

      async initTONConnect() {
        try {
          // Initialize TON Connect UI with minimal configuration
          if (typeof TON_CONNECT_UI !== 'undefined') {
            this.tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
              manifestUrl: window.location.origin + '/tonconnect-manifest.json'
            });

            // Listen for wallet connection status changes
            this.tonConnectUI.onStatusChange((walletInfo) => {
              this.handleWalletConnection(walletInfo);
            });

            console.log('‚úÖ TON Connect SDK initialized');
          } else {
            console.log('‚ö†Ô∏è TON Connect UI not loaded, creating fallback');
            this.createTONConnectFallback();
          }
        } catch (error) {
          console.error('‚ùå TON Connect initialization failed:', error);
          this.createTONConnectFallback();
        }
      }

      createTONConnectFallback() {
        // TON Connect –∫–Ω–æ–ø–∫–∞ —Å–∫—Ä—ã—Ç–∞, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
        const headerLogo = document.getElementById('headerLogo');
        if (this.user) {
          // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          headerLogo.innerHTML = `
            <div class="user-header">
              <div class="user-avatar">
                ${this.user.photo_url ? 
                  `<img src="${this.user.photo_url}" alt="${this.user.first_name}" class="avatar-image">` :
                  `<div class="avatar-placeholder">${this.user.first_name?.charAt(0).toUpperCase() || '–ü'}</div>`
                }
              </div>
              <div class="user-name">${this.user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
            </div>
            <!-- TON Connect –∫–Ω–æ–ø–∫–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–≤–∏–¥–∏–º–∞ -->
            <button class="ton-connect-button" id="tonConnectBtn" style="display: none; position: absolute; visibility: hidden;">TON</button>
          `;
        }

        // Add click handler (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ)
        const tonBtn = document.getElementById('tonConnectBtn');
        if (tonBtn) {
          tonBtn.addEventListener('click', () => {
            this.showWalletStatus('TON Connect –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è...');
            // In real app, this would open TON Connect modal
          });
        }
      }

      updateUserHeader() {
        if (!this.user) {
          console.log('‚ùå No user data for header update');
          return;
        }
        
        console.log('üîÑ Updating user header with:', this.user);
        
        const headerLogo = document.getElementById('headerLogo');
        headerLogo.innerHTML = `
          <div class="user-header">
            <div class="user-avatar">
              ${this.user.photo_url ? 
                `<img src="${this.user.photo_url}" alt="${this.user.first_name}" class="avatar-image">` :
                `<div class="avatar-placeholder">${this.user.first_name?.charAt(0).toUpperCase() || '–ü'}</div>`
              }
            </div>
            <div class="user-name">${this.user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
          </div>
          <!-- TON Connect –∫–Ω–æ–ø–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç–∞, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ -->
          <button class="ton-connect-button" id="tonConnectBtn" style="display: none; position: absolute; visibility: hidden;">TON</button>
        `;

        console.log('‚úÖ User header updated successfully');

        // Re-attach TON Connect button handler (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ)
        const tonBtn = document.getElementById('tonConnectBtn');
        if (tonBtn) {
          tonBtn.addEventListener('click', () => {
            if (this.tonConnectUI) {
              this.tonConnectUI.openModal();
            } else {
              this.showWalletStatus('TON Connect –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è...');
            }
          });
        }
      }

      initAnalytics() {
        // Track app initialization
        this.trackEvent('app_initialized', {
          user_id: this.user?.id,
          timestamp: Date.now(),
          platform: 'telegram_mini_app'
        });

        console.log('‚úÖ